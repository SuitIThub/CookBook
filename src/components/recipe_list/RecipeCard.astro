---
import type { Recipe } from '../../types/recipe';
import RecipeImageCarousel from './RecipeImageCarousel.astro';

interface Props {
  recipe: Recipe;
}

const { recipe } = Astro.props;
---

<div class="recipe-card group relative" data-recipe-id={recipe.id}>
  <!-- Selection Checkbox -->
  <div class="selection-indicator absolute top-2 left-2 z-10 opacity-0 md:group-hover:opacity-100 transition-opacity">
    <input 
      type="checkbox" 
      class="recipe-select-checkbox w-5 h-5 rounded border-gray-300 text-orange-600 focus:ring-orange-500 cursor-pointer"
      data-recipe-id={recipe.id}
    >
  </div>

  <!-- Recipe Image Carousel -->
  <RecipeImageCarousel images={recipe.images || []} />
  
  <!-- Recipe Content -->
  <div class="card-content">
    <div class="mb-3">
      <h3 class="heading-tertiary mb-1">
        <a href={`/rezept/${recipe.id}`} class="recipe-link hover:text-orange-600 dark:hover:text-orange-400 transition-colors">
          {recipe.title}
        </a>
      </h3>
      {recipe.subtitle && (
        <p class="text-sm text-muted">{recipe.subtitle}</p>
      )}
    </div>
    
    {recipe.description && (
      <p class="text-body text-sm mb-4 line-clamp-2">{recipe.description}</p>
    )}
    
    <!-- Recipe Metadata -->
    <div class="flex flex-wrap gap-2 mb-4">
      {recipe.metadata.servings && (
        <span class="badge badge-gray">
          <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
            <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
          </svg>
          {recipe.metadata.servings} Portionen
        </span>
      )}
      {recipe.metadata.timeEntries && recipe.metadata.timeEntries.length > 0 && (
        <span class="badge badge-blue">
          <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
          </svg>
          {recipe.metadata.timeEntries.reduce((total, entry) => total + entry.minutes, 0)} Min
        </span>
      )}
      {recipe.metadata.difficulty && (
        <span class={`badge ${
          recipe.metadata.difficulty === 'leicht' ? 'badge-green' :
          recipe.metadata.difficulty === 'mittel' ? 'badge-yellow' :
          'badge-red'
        }`}>
          {recipe.metadata.difficulty}
        </span>
      )}
    </div>
    
    <!-- Action Buttons -->
    <div class="flex space-x-2">
      <a href={`/rezept/${recipe.id}`} class="recipe-link btn btn-primary flex-1 text-center">
        Anzeigen
      </a>
      <!-- Export dropdown -->
      <div class="relative">
        <button class={`export-recipe-btn btn btn-icon text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600`} data-recipe-id={recipe.id}>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
          </svg>
        </button>
        <div class={`export-menu hidden absolute right-0 bottom-full mb-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-10`}>
          <div class="py-1">
            <button class="export-json flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-recipe-id={recipe.id}>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              JSON (ohne Bilder)
            </button>
            <button class="export-rcb flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-recipe-id={recipe.id}>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
              </svg>
              Vollst√§ndig (mit Bildern)
            </button>
          </div>
        </div>
      </div>
      <button class="btn btn-icon text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<style>
  .recipe-card.selected {
    @apply ring-2 ring-orange-500;
  }
  
  .recipe-card.selected .selection-indicator {
    @apply opacity-100;
  }

  .recipe-card.selection-mode {
    @apply cursor-pointer;
  }

  .recipe-card.selection-mode .recipe-link {
    @apply pointer-events-none;
  }

  .recipe-card.selection-mode .selection-indicator {
    @apply opacity-100;
  }
</style> 