---
import Layout from '../layouts/Layout.astro';
import { db } from '../lib/database';
import ShoppingListHeader from '../components/shopping_list/ShoppingListHeader.astro';
import ShoppingListSection from '../components/shopping_list/ShoppingListSection.astro';

// Einkaufslisten aus der Datenbank laden
let shoppingLists = [];
try {
  shoppingLists = db.getAllShoppingLists();
} catch (error) {
  console.error('Error loading shopping lists from database:', error);
  shoppingLists = [];
}

// Erste Einkaufsliste verwenden oder leere Liste erstellen
const shoppingList = shoppingLists.length > 0 ? shoppingLists[0] : {
  id: '',
  title: 'Keine Einkaufsliste vorhanden',
  items: [],
  createdAt: new Date(),
  updatedAt: new Date()
};

const checkedItems = shoppingList.items.filter(item => item.isChecked);
const uncheckedItems = shoppingList.items.filter(item => !item.isChecked);
---

<Layout title="Einkaufsliste - Kochbuch">
  <div class="container-narrow">
    <!-- Header -->
    <ShoppingListHeader 
      title="Einkaufsliste"
      openItemsCount={uncheckedItems.length}
      totalItemsCount={shoppingList.items.length}
    />

    <div class="grid-two-cols">
      <!-- Unchecked Items -->
      <ShoppingListSection 
        title="Noch zu kaufen"
        count={uncheckedItems.length}
        items={uncheckedItems}
        isChecked={false}
      />

      <!-- Checked Items -->
      <ShoppingListSection 
        title="Erledigt"
        count={checkedItems.length}
        items={checkedItems}
        isChecked={true}
      />
    </div>
  </div>
</Layout> 